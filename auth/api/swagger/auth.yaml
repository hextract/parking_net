---
swagger: "2.0"
info:
  description: "Parking Net Go project | Auth svc"
  version: "0.1.0"
  title: "parkings.auth"
schemes:
  #  - "https"
  - "http"
paths:
  /auth/login:
    post:
      summary: "Sign in user by login and password"
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            type: "object"
            required:
              - "login"
              - "password"
            properties:
              login:
                type: "string"
              password:
                type: "string"
      responses:
        200:
          description: "Success"
          schema:
            type: "object"
            properties:
              token:
                type: "string"
        401:
          schema:
            $ref: "#/definitions/Error"
          description: "Incorrect login data"

  /auth/register:
    post:
      summary: "Register user by username and password"
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            type: "object"
            required:
              - "email"
              - "login"
              - "password"
              - "role"
              - "telegram_id"
            properties:
              email:
                type: "string"
              login:
                type: "string"
              password:
                type: "string"
              role:
                type: "string"
                enum:
                  - "driver"
                  - "owner"
              telegram_id:
                type: integer
      responses:
        200:
          description: "Success operation"
          schema:
            type: "object"
            properties:
              token:
                type: "string"
        409:
          schema:
            $ref: "#/definitions/Error"
          description: "Incorrect data"

  /auth/change-password:
    post:
      summary: "Change password"
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            type: "object"
            required:
              - "login"
              - "oldPassword"
              - "newPassword"
            properties:
              login:
                type: "string"
              oldPassword:
                type: "string"
              newPassword:
                type: "string"
      responses:
        200:
          description: "Success operation"
          schema:
            type: "object"
            properties:
              token:
                type: "string"
        400:
          schema:
            $ref: "#/definitions/Error"
          description: "Incorrect data"
        401:
          schema:
            $ref: "#/definitions/Error"
          description: "Incorrect old password"
  /auth/me:
    get:
      summary: "Get current user info by token"
      produces:
        - "application/json"
      parameters:
        - in: "header"
          name: "api_key"
          type: "string"
          required: true
          description: "JWT token"
      responses:
        200:
          description: "Success"
          schema:
            type: "object"
            properties:
              user_id:
                type: "string"
                description: "Keycloak user ID (UUID)"
              login:
                type: "string"
              email:
                type: "string"
              role:
                type: "string"
                enum:
                  - "driver"
                  - "owner"
                  - "admin"
              telegram_id:
                type: integer
        401:
          schema:
            $ref: "#/definitions/Error"
          description: "Unauthorized"
  /auth/metrics:
    get:
      summary: "Prometheus metrics"
      produces:
        - "application/json"
      responses:
        200:
          description: ok

definitions:
  Error:
    type: "object"
    required:
      - "error_status_code"
    properties:
      error_message:
        type: "string"
      error_status_code:
        type: integer
